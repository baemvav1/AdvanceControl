<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="Advance_Control.Views.Pages.AreasView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="using:Advance_Control.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="using:Advance_Control.Views.Pages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:Advance_Control.Models"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
    mc:Ignorable="d">

    <Page.Resources>
        <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!--  Row 0: Header  -->
        <StackPanel Grid.Row="0" Margin="20,20,20,12" Spacing="12">
            <!--  Page Header  -->
            <TextBlock
                FontSize="32"
                FontWeight="Bold"
                Text="Áreas" />
        </StackPanel>

        <!--  Row 1: Map and Forms  -->
        <Grid Grid.Row="1" Margin="20,0,20,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="400" />
            </Grid.ColumnDefinitions>

            <!--  Column 0: Map  -->
            <Grid Grid.Column="0" Margin="0,0,10,0" CornerRadius="10">
                <!--  Loading Indicator  -->
                <StackPanel
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <ProgressRing
                        Width="50"
                        Height="50"
                        IsActive="True" />
                    <TextBlock
                        Margin="0,12,0,0"
                        HorizontalAlignment="Center"
                        Text="Cargando mapa..." />
                </StackPanel>

                <!--  Error Message  -->
                <InfoBar
                    Margin="0,0,0,12"
                    VerticalAlignment="Top"
                    IsOpen="{x:Bind ViewModel.HasError, Mode=OneWay}"
                    Message="{x:Bind ViewModel.ErrorMessage, Mode=OneWay}"
                    Severity="Error" />

                <!--  WebView2 for Google Maps  -->
                <WebView2
                    x:Name="MapWebView"
                    NavigationCompleted="MapWebView_NavigationCompleted"
                    Visibility="{x:Bind ViewModel.IsMapInitialized, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}" />
            </Grid>

            <!--  Column 1: Forms and Lists  -->
            <ScrollViewer Grid.Column="1" VerticalScrollMode="Auto" VerticalScrollBarVisibility="Auto">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!--  Area List Header  -->
                    <StackPanel Grid.Row="0" Margin="0,0,0,12">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <TextBlock
                                FontSize="20"
                                FontWeight="SemiBold"
                                Text="Lista de Áreas" />
                            <Button
                                x:Name="RefreshButton"
                                Margin="0,0,0,0"
                                VerticalAlignment="Center"
                                Background="Transparent"
                                BorderThickness="0"
                                Click="RefreshButton_Click"
                                ToolTipService.ToolTip="Recargar áreas">
                                <SymbolIcon Symbol="Refresh" />
                            </Button>
                        </StackPanel>
                        <Button
                            x:Name="AddButton"
                            Margin="0,8,0,0"
                            Click="AddButton_Click">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <SymbolIcon Symbol="Add" />
                                <TextBlock Text="Agregar Área" />
                            </StackPanel>
                        </Button>
                    </StackPanel>

                    <!--  Area List  -->
                    <ScrollViewer Grid.Row="1">
                        <ListView
                            x:Name="AreasList"
                            ItemsSource="{x:Bind ViewModel.Areas, Mode=OneWay}"
                            SelectedItem="{x:Bind ViewModel.SelectedArea, Mode=TwoWay}"
                            SelectionChanged="AreasList_SelectionChanged">
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="models:AreaDto">
                                    <Grid Padding="8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0">
                                            <TextBlock FontWeight="SemiBold" Text="{x:Bind Nombre}" />
                                            <TextBlock
                                                FontSize="12"
                                                Foreground="Gray"
                                                Text="{x:Bind Descripcion}" />
                                            <TextBlock FontSize="11" Foreground="Gray">
                                                <Run Text="Tipo: " />
                                                <Run Text="{x:Bind TipoGeometria}" />
                                            </TextBlock>
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <Rectangle
                                                    Width="16"
                                                    Height="16"
                                                    Fill="{x:Bind ColorMapa}"
                                                    RadiusX="2"
                                                    RadiusY="2" />
                                                <TextBlock
                                                    FontSize="10"
                                                    Foreground="Gray"
                                                    Text="{x:Bind ColorMapa}" />
                                            </StackPanel>
                                        </StackPanel>
                                        <StackPanel
                                            Grid.Column="1"
                                            Orientation="Horizontal"
                                            Spacing="4">
                                            <Button
                                                Click="EditButton_Click"
                                                Tag="{x:Bind IdArea}"
                                                ToolTipService.ToolTip="Editar">
                                                <SymbolIcon Symbol="Edit" />
                                            </Button>
                                            <Button
                                                Click="DeleteButton_Click"
                                                Tag="{x:Bind IdArea}"
                                                ToolTipService.ToolTip="Eliminar">
                                                <SymbolIcon Symbol="Delete" />
                                            </Button>
                                        </StackPanel>
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </ScrollViewer>

                    <!--  Area Form  -->
                    <StackPanel
                        x:Name="AreaForm"
                        Grid.Row="2"
                        Margin="0,12,0,0"
                        Padding="12"
                        Background="{ThemeResource LayerFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Spacing="8"
                        Visibility="Collapsed">

                        <TextBlock
                            x:Name="FormTitle"
                            FontSize="18"
                            FontWeight="SemiBold"
                            Text="Nueva Área" />

                        <InfoBar
                            Margin="0,4,0,4"
                            IsClosable="False"
                            IsOpen="True"
                            Message="Utiliza las herramientas de dibujo del mapa para crear un polígono o círculo que defina el área."
                            Severity="Informational" />

                        <TextBox
                            x:Name="NombreTextBox"
                            Header="Nombre *"
                            PlaceholderText="Nombre del área" />

                        <TextBox
                            x:Name="DescripcionTextBox"
                            Height="60"
                            AcceptsReturn="True"
                            Header="Descripción"
                            PlaceholderText="Descripción opcional"
                            TextWrapping="Wrap" />

                        <ComboBox
                            x:Name="ColorComboBox"
                            Width="200"
                            HorizontalAlignment="Left"
                            Header="Color del área">
                            <ComboBoxItem Content="Rojo" IsSelected="True" Tag="#FF0000" />
                            <ComboBoxItem Content="Azul" Tag="#0000FF" />
                            <ComboBoxItem Content="Verde" Tag="#00FF00" />
                            <ComboBoxItem Content="Amarillo" Tag="#FFFF00" />
                            <ComboBoxItem Content="Naranja" Tag="#FFA500" />
                            <ComboBoxItem Content="Púrpura" Tag="#800080" />
                            <ComboBoxItem Content="Rosa" Tag="#FFC0CB" />
                        </ComboBox>

                        <CheckBox
                            x:Name="ActivoCheckBox"
                            Content="Activo"
                            IsChecked="True" />

                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <Button
                                x:Name="SaveButton"
                                Click="SaveButton_Click"
                                Style="{StaticResource AccentButtonStyle}">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <SymbolIcon Symbol="Save" />
                                    <TextBlock Text="Guardar" />
                                </StackPanel>
                            </Button>
                            <Button
                                x:Name="CancelButton"
                                Click="CancelButton_Click">
                                Cancelar
                            </Button>
                        </StackPanel>
                    </StackPanel>
                </Grid>
            </ScrollViewer>
        </Grid>
    </Grid>
</Page>
