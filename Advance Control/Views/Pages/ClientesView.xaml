<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="Advance_Control.Views.ClientesView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Advance_Control.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:converters="using:Advance_Control.Converters"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
    
    <Page.Resources>
        <converters:LevelToBackgroundConverter x:Key="LevelToBackgroundConverter"/>
        <converters:LevelToForegroundConverter x:Key="LevelToForegroundConverter"/>
    </Page.Resources>

    <Grid Padding="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Spacing="8" Margin="0,0,0,24">
            <TextBlock Text="Clientes" FontSize="32" FontWeight="Bold"/>
            <TextBlock Text="Gestión de clientes del sistema" FontSize="16" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
        </StackPanel>

        <!-- Filtros -->
        <StackPanel Grid.Row="1" Spacing="12" Margin="0,0,0,16">
            <TextBlock Text="Filtros de búsqueda" FontWeight="SemiBold" FontSize="16"/>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TextBox Grid.Row="0" Grid.Column="0" 
                         Header="Búsqueda" 
                         PlaceholderText="Razón social o nombre comercial"
                         Text="{x:Bind ViewModel.SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,0,8,8"/>

                <TextBox Grid.Row="0" Grid.Column="1" 
                         Header="RFC" 
                         PlaceholderText="RFC del cliente"
                         Text="{x:Bind ViewModel.RfcFilter, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,0,8,8"/>

                <TextBox Grid.Row="0" Grid.Column="2" 
                         Header="CURP" 
                         PlaceholderText="CURP del cliente"
                         Text="{x:Bind ViewModel.CurpFilter, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,0,8,8"/>

                <TextBox Grid.Row="1" Grid.Column="0" 
                         Header="Notas" 
                         PlaceholderText="Búsqueda en notas"
                         Text="{x:Bind ViewModel.NotasFilter, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,0,8,8"/>
                
                
                <!--Value="{x:Bind ViewModel.PrioridadFilter, Mode=TwoWay}"-->

                <NumberBox Grid.Row="1" Grid.Column="1" 
                           Header="Prioridad" 
                           PlaceholderText="Prioridad exacta"
                           SpinButtonPlacementMode="Inline"
                           Minimum="0"
                           Margin="0,0,8,8"/>

                <StackPanel Grid.Row="1" Grid.Column="2" Grid.ColumnSpan="2" 
                            Orientation="Horizontal" 
                            HorizontalAlignment="Right" 
                            VerticalAlignment="Bottom"
                            Spacing="8">
                    <Button Content="Buscar" 
                            Click="SearchButton_Click"
                            Style="{StaticResource AccentButtonStyle}"/>
                    <Button Content="Limpiar" 
                            Click="ClearButton_Click"/>
                </StackPanel>
            </Grid>
        </StackPanel>

        <!-- Lista de clientes -->
        <Grid Grid.Row="2">
            <!-- Loading indicator -->
            <ProgressRing IsActive="{x:Bind ViewModel.IsLoading, Mode=OneWay}" 
                          Width="50" 
                          Height="50"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Center"/>

            <!-- ItemsRepeater con ScrollViewer -->
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <ItemsRepeater ItemsSource="{x:Bind ViewModel.Customers, Mode=OneWay}">
                    <ItemsRepeater.Layout>
                        <StackLayout Spacing="0"/>
                    </ItemsRepeater.Layout>
                    <ItemsRepeater.ItemTemplate>
                        <DataTemplate x:DataType="local:CustomerDto" xmlns:local="using:Advance_Control.Models">
                            <Grid Padding="16" 
                                  BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                                  BorderThickness="0,0,0,1" 
                                  MinHeight="90"
                                  Background="{x:Bind Prioridad, Converter={StaticResource LevelToBackgroundConverter}}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <!-- Información principal del cliente -->
                                <StackPanel Grid.Column="0" Spacing="6">
                                    <TextBlock Text="{x:Bind RazonSocial}" 
                                               FontWeight="SemiBold" 
                                               FontSize="16"
                                               Foreground="{x:Bind Prioridad, Converter={StaticResource LevelToForegroundConverter}}"/>
                                    <TextBlock Text="{x:Bind NombreComercial}" 
                                               FontSize="14"
                                               Foreground="{x:Bind Prioridad, Converter={StaticResource LevelToForegroundConverter}}"/>
                                    <StackPanel Orientation="Horizontal" Spacing="20">
                                        <TextBlock FontSize="13"
                                                   Foreground="{x:Bind Prioridad, Converter={StaticResource LevelToForegroundConverter}}">
                                            <Run Text="RFC: "/>
                                            <Run Text="{x:Bind Rfc}" FontWeight="SemiBold"/>
                                        </TextBlock>
                                        <TextBlock FontSize="13"
                                                   Foreground="{x:Bind Prioridad, Converter={StaticResource LevelToForegroundConverter}}">
                                            <Run Text="Prioridad: "/>
                                            <Run Text="{x:Bind Prioridad}" FontWeight="SemiBold"/>
                                        </TextBlock>
                                    </StackPanel>
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </ItemsRepeater.ItemTemplate>
                </ItemsRepeater>
            </ScrollViewer>
        </Grid>
    </Grid>
</Page>
