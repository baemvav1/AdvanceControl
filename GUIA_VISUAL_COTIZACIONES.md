# GuÃ­a Visual: Generador de Cotizaciones

## Vista Previa del BotÃ³n "Generar CotizaciÃ³n"

### UbicaciÃ³n en la Interfaz

El botÃ³n se encuentra en la vista de **Operaciones**, dentro del pivot de **Cargos**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Operaciones                                                 â”‚
â”‚  GestiÃ³n de operaciones del sistema                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  [Filtros de bÃºsqueda...]                                   â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ [â–¼] OperaciÃ³n - Cliente ABC - Equipo XYZ              â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚ [ InformaciÃ³n ] [ Nota ] [ Acciones ] [ Cargos ]â”‚  â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚ â”‚
â”‚  â”‚  â”‚                                                   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  [+ Agregar Cargo] [ğŸ“„ Generar CotizaciÃ³n]      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ Tipo | Detalle | Proveedor | Nota | Montoâ”‚   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ RefacciÃ³n | Tornillo M8 | ABC | ... | $50â”‚   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ Servicio | InstalaciÃ³n | XYZ | ... |$200â”‚   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Total: $250.00                                  â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CaracterÃ­sticas del BotÃ³n

**Aspecto Visual**:
- Icono: ğŸ“„ (SÃ­mbolo de documento)
- Texto: "Generar CotizaciÃ³n"
- Color: Acento secundario claro
- UbicaciÃ³n: Junto al botÃ³n "Agregar Cargo"

**Estados**:
- Activo: Cuando hay cargos en la operaciÃ³n
- El botÃ³n estÃ¡ siempre visible, pero muestra error si no hay cargos

## Flujo de Uso

### 1. Estado Inicial
```
Usuario navega a la vista de Operaciones
         â†“
Expande una operaciÃ³n especÃ­fica
         â†“
Selecciona el pivot "Cargos"
         â†“
Ve la lista de cargos y el botÃ³n "Generar CotizaciÃ³n"
```

### 2. GeneraciÃ³n de CotizaciÃ³n
```
Usuario hace clic en "Generar CotizaciÃ³n"
         â†“
Sistema valida que existan cargos
         â†“
[SI HAY CARGOS]                    [NO HAY CARGOS]
         â†“                                  â†“
Genera PDF en background          Muestra notificaciÃ³n
         â†“                         "No hay cargos"
Muestra diÃ¡logo de Ã©xito
con ruta del archivo
         â†“
[Usuario elige "Abrir"]            [Usuario elige "Cerrar"]
         â†“                                  â†“
Abre PDF con visor             Cierra diÃ¡logo
predeterminado                          â†“
                               Muestra notificaciÃ³n de Ã©xito
```

### 3. Resultado Final
```
PDF generado en:
ğŸ“ Mis Documentos
  â””â”€ ğŸ“ Advance Control
      â””â”€ ğŸ“ Cotizaciones
          â””â”€ ğŸ“„ Cotizacion_ClienteABC_20260131_220500.pdf
```

## DiÃ¡logos del Sistema

### DiÃ¡logo de Ã‰xito
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CotizaciÃ³n generada                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚ La cotizaciÃ³n se ha generado exitosamente  â”‚
â”‚ en:                                         â”‚
â”‚                                             â”‚
â”‚ C:\Users\...\Documents\Advance Control\    â”‚
â”‚ Cotizaciones\Cotizacion_ClienteABC_...pdf  â”‚
â”‚                                             â”‚
â”‚ Â¿Desea abrir el archivo?                   â”‚
â”‚                                             â”‚
â”‚         [  Abrir  ]      [ Cerrar ]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### NotificaciÃ³n de Ã‰xito
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â„¹ CotizaciÃ³n generada        â”‚
â”‚                              â”‚
â”‚ La cotizaciÃ³n PDF se ha      â”‚
â”‚ generado correctamente.      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Error - Sin Cargos
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš  No hay cargos              â”‚
â”‚                              â”‚
â”‚ No se puede generar una      â”‚
â”‚ cotizaciÃ³n porque no hay     â”‚
â”‚ cargos asociados a esta      â”‚
â”‚ operaciÃ³n.                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Error - Fallo en GeneraciÃ³n
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âŒ Error                      â”‚
â”‚                              â”‚
â”‚ OcurriÃ³ un error al generar  â”‚
â”‚ la cotizaciÃ³n. Por favor,    â”‚
â”‚ intente nuevamente.          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Estructura del PDF Generado

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                               â•‘
â•‘            ADVANCE CONTROL                                    â•‘
â•‘            CotizaciÃ³n de Servicio                             â•‘
â•‘                                                               â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                               â•‘
â•‘  InformaciÃ³n del Cliente          InformaciÃ³n de la OperaciÃ³nâ•‘
â•‘  â€¢ Cliente: ABC Corporation       â€¢ Fecha: 31/01/2026        â•‘
â•‘  â€¢ Equipo: Compresor XYZ-123      â€¢ Atendido por: Juan PÃ©rez â•‘
â•‘                                   â€¢ Tipo: Correctivo          â•‘
â•‘                                                               â•‘
â•‘  Desglose de Cargos                                          â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚ Tipo      â”‚ Detalle      â”‚ Proveedor â”‚ Nota  â”‚ Monto â”‚  â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â•‘
â•‘  â”‚ RefacciÃ³n â”‚ Tornillo M8  â”‚ ABC Corp  â”‚ -     â”‚ $50.00â”‚  â•‘
â•‘  â”‚ Servicio  â”‚ InstalaciÃ³n  â”‚ XYZ Ltd   â”‚ Urgenteâ”‚$200.00â”‚  â•‘
â•‘  â”‚ RefacciÃ³n â”‚ Filtro aire  â”‚ ABC Corp  â”‚ -     â”‚$150.00â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                                                               â•‘
â•‘                                        TOTAL: $400.00         â•‘
â•‘                                                               â•‘
â•‘  Notas Adicionales                                           â•‘
â•‘  â€¢ Servicio realizado con prioridad alta                     â•‘
â•‘  â€¢ Cliente requiere factura electrÃ³nica                      â•‘
â•‘                                                               â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                      PÃ¡gina 1 de 1                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## CaracterÃ­sticas del PDF

### Formato y DiseÃ±o
- **TamaÃ±o**: Letter (8.5" x 11")
- **MÃ¡rgenes**: 2 cm en todos los lados
- **Fuente**: Sans-serif, tamaÃ±o 11pt
- **Colores**: 
  - Encabezado: Fondo azul claro con texto azul oscuro
  - Tabla: Filas con bordes grises claros
  - Total: Destacado en azul

### Contenido Incluido
âœ… Nombre de la empresa (ADVANCE CONTROL)  
âœ… TÃ­tulo del documento (CotizaciÃ³n de Servicio)  
âœ… InformaciÃ³n del cliente  
âœ… InformaciÃ³n del equipo  
âœ… Fecha de la operaciÃ³n  
âœ… Personal que atiende  
âœ… Tipo de operaciÃ³n  
âœ… Tabla detallada de cargos  
âœ… Suma total  
âœ… Notas adicionales  
âœ… PaginaciÃ³n  

### Seguridad del Archivo
- âœ… Nombre sanitizado (sin caracteres especiales)
- âœ… UbicaciÃ³n segura (carpeta del usuario)
- âœ… Sin informaciÃ³n sensible expuesta
- âœ… Solo lectura para el usuario

## Ejemplo de Nomenclatura

### Formato del Nombre de Archivo
```
Cotizacion_[ClienteNombre]_[YYYYMMDD]_[HHMMSS].pdf
```

### Ejemplos Reales
```
Cotizacion_ABC_Corporation_20260131_220530.pdf
Cotizacion_XYZ_Servicios_20260131_143022.pdf
Cotizacion_Cliente_Sin_Nombre_20260131_091545.pdf
```

### SanitizaciÃ³n de Nombres
```
Cliente Original          â†’  Nombre Sanitizado
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
"ABC/Corporation"        â†’  "ABC_Corporation"
"Client*Name?"           â†’  "Client_Name_"
"Test:Company"           â†’  "Test_Company"
"Normal Name"            â†’  "Normal_Name"
```

## IntegraciÃ³n con el Sistema

### Servicios Utilizados
```
[OperacionesView] (UI)
        â†“
[OperacionesViewModel] (LÃ³gica)
        â†“
[QuoteService] (GeneraciÃ³n PDF)
        â†“
[LoggingService] (Registro)
```

### Flujo de Datos
```
1. Usuario â†’ Click en botÃ³n
2. View â†’ Valida operaciÃ³n
3. View â†’ Llama ViewModel.GenerateQuoteAsync()
4. ViewModel â†’ Valida cargos
5. ViewModel â†’ Llama QuoteService.GenerateQuotePdfAsync()
6. QuoteService â†’ Crea PDF con QuestPDF
7. QuoteService â†’ Guarda archivo
8. QuoteService â†’ Retorna ruta
9. ViewModel â†’ Retorna resultado
10. View â†’ Muestra diÃ¡logo
11. View â†’ Muestra notificaciÃ³n
```

## Pruebas Recomendadas

### Casos de Prueba
1. âœ… OperaciÃ³n con mÃºltiples cargos
2. âœ… OperaciÃ³n con un solo cargo
3. âœ… OperaciÃ³n sin cargos (debe fallar)
4. âœ… Cliente con nombre especial (caracteres)
5. âœ… OperaciÃ³n con notas adicionales
6. âœ… OperaciÃ³n sin notas adicionales
7. âœ… GeneraciÃ³n mÃºltiple (misma operaciÃ³n)
8. âœ… Apertura del PDF generado

### Validaciones
- âœ… PDF se crea en la ubicaciÃ³n correcta
- âœ… Nombre de archivo es vÃ¡lido
- âœ… Contenido del PDF es correcto
- âœ… Total calculado correctamente
- âœ… Formato profesional
- âœ… Sin errores en consola

## SoluciÃ³n de Problemas Comunes

### El botÃ³n no aparece
**Causa**: Vista no actualizada  
**SoluciÃ³n**: Cerrar y reabrir la aplicaciÃ³n

### "No hay cargos"
**Causa**: OperaciÃ³n sin cargos asociados  
**SoluciÃ³n**: Agregar cargos antes de generar cotizaciÃ³n

### PDF no se abre
**Causa**: No hay lector de PDF instalado  
**SoluciÃ³n**: Instalar Adobe Reader o similar

### Error al generar
**Causa**: Permisos de escritura  
**SoluciÃ³n**: Verificar permisos en carpeta Documentos

---

**Nota**: Esta guÃ­a visual complementa la documentaciÃ³n tÃ©cnica en `IMPLEMENTACION_GENERADOR_COTIZACIONES.md`
