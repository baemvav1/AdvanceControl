<?xml version="1.0" encoding="utf-8" ?>
<UserControl
    x:Class="Advance_Control.Views.Login.LoginView" xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="using:Advance_Control.Views.Login" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" mc:Ignorable="d">

    <Grid
        Padding="20"
        Background="{ThemeResource LayerFillColorDefaultBrush}"
        CornerRadius="8">
        
        <!-- Login Form (visible when not authenticated) -->
        <Grid Visibility="{x:Bind ViewModel.IsNotAuthenticated, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <TextBlock
                Grid.Row="0" Margin="4" FontWeight="SemiBold" Text="Usuario:" />
            <TextBox
                x:Name="UserTextBox" Grid.Row="1" Width="300" Margin="4,4,4,12"
                PlaceholderText="Ingrese su nombre de usuario"
                Text="{x:Bind ViewModel.User, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

            <TextBlock
                Grid.Row="2" Margin="4" FontWeight="SemiBold" Text="Contraseña:" />
            <PasswordBox
                x:Name="PasswordBox" Grid.Row="3" Width="300" Margin="4,4,4,12"
                Password="{x:Bind ViewModel.Password, Mode=TwoWay}"
                PlaceholderText="Ingrese su contraseña" />

            <!--  Checkbox de Recordar Credenciales  -->
            <CheckBox
                Grid.Row="4"
                Margin="4,0,4,12"
                Content="Recordar mi usuario y contraseña"
                IsChecked="{x:Bind ViewModel.RememberMe, Mode=TwoWay}" />

            <!--  Error Message Display  -->
            <InfoBar
                x:Name="ErrorInfoBar" Grid.Row="5" Margin="4,0,4,12"
                IsOpen="{x:Bind ViewModel.HasError, Mode=OneWay}"
                Message="{x:Bind ViewModel.ErrorMessage, Mode=OneWay}"
                Severity="Error" />

            <StackPanel
                Grid.Row="6" Margin="4" HorizontalAlignment="Right" Orientation="Horizontal"
                Spacing="8">
                <Button
                    x:Name="LoginButton"
                    Command="{x:Bind ViewModel.LoginCommand}"
                    Content="Iniciar Sesión"
                    IsEnabled="{x:Bind ViewModel.CanLogin, Mode=OneWay}"
                    Style="{StaticResource AccentButtonStyle}" />
                <Button
                    x:Name="CancelButton" Click="CancelButton_Click" Content="Cancelar" />
            </StackPanel>
        </Grid>
        
        <!-- Logout Panel (visible when authenticated) -->
        <Grid Visibility="{x:Bind ViewModel.IsAuthenticated, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <TextBlock
                Grid.Row="0" 
                Margin="4,4,4,12"
                FontSize="16"
                FontWeight="SemiBold"
                Text="Ya tiene una sesión activa"
                TextAlignment="Center" />

            <InfoBar
                Grid.Row="1"
                Margin="4,0,4,12"
                IsOpen="True"
                Message="Ya se encuentra autenticado. Puede cerrar esta ventana o cerrar sesión."
                Severity="Informational" />

            <!--  Error Message Display  -->
            <InfoBar
                x:Name="LogoutErrorInfoBar" Grid.Row="2" Margin="4,0,4,12"
                IsOpen="{x:Bind ViewModel.HasError, Mode=OneWay}"
                Message="{x:Bind ViewModel.ErrorMessage, Mode=OneWay}"
                Severity="Error" />

            <StackPanel
                Grid.Row="3" 
                Margin="4" 
                HorizontalAlignment="Right" 
                Orientation="Horizontal"
                Spacing="8">
                <Button
                    x:Name="LogoutButton"
                    Command="{x:Bind ViewModel.LogoutCommand}"
                    Content="Cerrar Sesión"
                    Style="{StaticResource AccentButtonStyle}" />
                <Button
                    x:Name="CloseButton" 
                    Click="CancelButton_Click" 
                    Content="Cerrar" />
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>
