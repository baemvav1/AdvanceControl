# DIAGRAMA DE FLUJO DEL SISTEMA - Advance Control

## ๐ รNDICE
1. [Flujo Principal de la Aplicaciรณn](#flujo-principal)
2. [Flujo de Autenticaciรณn](#flujo-autenticaciรณn)
3. [Flujo de Navegaciรณn](#flujo-navegaciรณn)
4. [Flujo de Logging](#flujo-logging)
5. [Flujo de Verificaciรณn de Conectividad](#flujo-conectividad)
6. [Diagrama de Dependencias](#diagrama-dependencias)

---

## 1. FLUJO PRINCIPAL DE LA APLICACIรN {#flujo-principal}

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                          INICIO DE APLICACIรN                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                   โ
                                   โผ
                    โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ      App.xaml.cs         โ
                    โ   Constructor ejecuta    โ
                    โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                   โ
                                   โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ   Configurar Host con Dependency Injection       โ
        โ   - Cargar appsettings.json                      โ
        โ   - Registrar servicios (Auth, Logging, etc.)    โ
        โ   - Registrar ViewModels                         โ
        โ   - Registrar MainWindow                         โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                   โ
                                   โผ
                    โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ   OnLaunched Event       โ
                    โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                   โ
                                   โผ
                    โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ   await Host.StartAsync()โ
                    โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                   โ
                                   โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ   Resolver MainWindow desde DI                   โ
        โ   - Inyecta MainViewModel con todas sus deps    โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                   โ
                                   โผ
                    โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ   MainWindow Constructor โ
                    โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                   โ
                                   โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ   - Establecer DataContext = MainViewModel       โ
        โ   - InitializeNavigation(contentFrame)           โ
        โ   - Suscribir eventos de NavigationView          โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                   โ
                                   โผ
                    โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ   window.Activate()      โ
                    โ   (Mostrar ventana)      โ
                    โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                   โ
                                   โผ
                    โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ   APLICACIรN LISTA       โ
                    โ   Usuario interactรบa     โ
                    โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## 2. FLUJO DE AUTENTICACIรN {#flujo-autenticaciรณn}

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        PROCESO DE AUTENTICACIรN                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโ
โ  AuthService       โ
โ  Constructor       โ
โโโโโโโโโโโโโโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  _initTask = LoadFromStorageAsync() โ  โ Carga tokens guardados
โ  (Tarea en background)               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ
         โโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ                           โ
         โผ                           โผ
โโโโโโโโโโโโโโโโโโโโ      โโโโโโโโโโโโโโโโโโโโ
โ Tokens existen   โ      โ No hay tokens    โ
โ y son vรกlidos    โ      โ guardados        โ
โโโโโโโโโโโโโโโโโโโโ      โโโโโโโโโโโโโโโโโโโโ
         โ                           โ
         โผ                           โผ
โโโโโโโโโโโโโโโโโโโโ      โโโโโโโโโโโโโโโโโโโโ
โ IsAuthenticated  โ      โ IsAuthenticated  โ
โ = true           โ      โ = false          โ
โโโโโโโโโโโโโโโโโโโโ      โโโโโโโโโโโโโโโโโโโโ


โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      FLUJO DE LOGIN (FUTURO)                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Usuario ingresa           โ
โ  username y password       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ MainViewModel.LoginAsync() โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ await _initTask (espera carga inicial) โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ AuthService.AuthenticateAsync()            โ
โ POST /api/Auth/login                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโ
              โ              โ              โ
              โผ              โผ              โผ
     โโโโโโโโโโโโโโ  โโโโโโโโโโโโโโ  โโโโโโโโโโโโโโ
     โ  รxito     โ  โ  Error     โ  โ  Exception โ
     โ  200 OK    โ  โ  4xx/5xx   โ  โ            โ
     โโโโโโโโโโโโโโ  โโโโโโโโโโโโโโ  โโโโโโโโโโโโโโ
              โ              โ              โ
              โผ              โผ              โผ
     โโโโโโโโโโโโโโ  โโโโโโโโโโโโโโ  โโโโโโโโโโโโโโ
     โ Guardar    โ  โ Retornar   โ  โ Log error  โ
     โ tokens     โ  โ false      โ  โ Retornar   โ
     โ            โ  โ            โ  โ false      โ
     โโโโโโโโโโโโโโ  โโโโโโโโโโโโโโ  โโโโโโโโโโโโโโ
              โ
              โผ
     โโโโโโโโโโโโโโโโโโโโโโโโโโ
     โ PersistTokensAsync()   โ
     โ - _accessToken         โ
     โ - _refreshToken        โ
     โ - _accessExpiresAtUtc  โ
     โโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
     โโโโโโโโโโโโโโโโโโโโโโโโโโ
     โ SecureStorage.SetAsync()โ
     โ Windows PasswordVault   โ
     โโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
     โโโโโโโโโโโโโโโโโโโโโโโโโโ
     โ IsAuthenticated = true โ
     โ Retornar true          โ
     โโโโโโโโโโโโโโโโโโโโโโโโโโ


โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   FLUJO DE REFRESH DE TOKEN                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ GetAccessTokenAsync()        โ
โ llamado por HttpHandler      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ยฟToken expira en < 15 seg?    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโ
              โ NO          โ Sร           โ
              โผ             โผ              โ
     โโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโโโโโโ โ
     โ Retornar    โ โ RefreshTokenAsyncโ โ
     โ token       โ โ (con lock)       โ โ
     โ actual      โ โโโโโโโโโโโโโโโโโโโโ โ
     โโโโโโโโโโโโโโโ          โ            โ
                              โผ            โ
              โโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
              โ POST /api/Auth/refresh  โ  โ
              โโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
                              โ            โ
                              โผ            โ
              โโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
              โ Guardar nuevos tokens   โ  โ
              โโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
                              โ            โ
                              โผ            โ
                    โโโโโโโโโโโโโโโ        โ
                    โ Retornar    โ        โ
                    โ nuevo token โ        โ
                    โโโโโโโโโโโโโโโ        โ
                                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ AuthenticatedHttpHandler intercepta
โ requests y aรฑade: Authorization: Bearer <token>
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ


โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              FLUJO DE MANEJO DE 401 UNAUTHORIZED                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Request HTTP a API         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ AuthenticatedHttpHandler   โ
โ SendAsync()                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Adjuntar Bearer Token      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Enviar request             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ยฟRespuesta = 401?          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โโโโโโโโโโโโฌโโโโโโโโโโโ
              โ NO       โ Sร       โ
              โผ          โผ          โ
     โโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโ
     โ Retornar    โ โ Dispose    โโ
     โ respuesta   โ โ respuesta  โโ
     โโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโ
                              โ     โ
                              โผ     โ
              โโโโโโโโโโโโโโโโโโโโโโโดโโโโโ
              โ RefreshTokenAsync()      โ
              โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โโโโโโโโโโโโฌโโโโโโโโโโโ
                              โ รxito    โ Fallo    โ
                              โผ          โผ          โ
                    โโโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโ
                    โ Clonar       โ โ Retornar   โโ
                    โ request      โ โ 401        โโ
                    โโโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโ
                              โ                     โ
                              โผ                     โ
              โโโโโโโโโโโโโโโโโโโโโโโโโโโโ          โ
              โ Adjuntar nuevo token     โ          โ
              โโโโโโโโโโโโโโโโโโโโโโโโโโโโ          โ
                              โ                     โ
                              โผ                     โ
              โโโโโโโโโโโโโโโโโโโโโโโโโโโโ          โ
              โ Reintentar request       โ          โ
              โโโโโโโโโโโโโโโโโโโโโโโโโโโโ          โ
                              โ                     โ
                              โผ                     โ
              โโโโโโโโโโโโโโโโโโโโโโโโโโโโ          โ
              โ Retornar nueva respuesta โ          โ
              โโโโโโโโโโโโโโโโโโโโโโโโโโโโ          โ
```

---

## 3. FLUJO DE NAVEGACIรN {#flujo-navegaciรณn}

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        SISTEMA DE NAVEGACIรN                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ MainViewModel.             โ
โ InitializeNavigation()     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ NavigationService.         โ
โ Initialize(contentFrame)   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Configurar rutas:                     โ
โ - Configure<OperacionesView>          โ
โ   ("Operaciones")                     โ
โ - Configure<AcesoriaView>             โ
โ   ("Asesoria")                        โ
โ - Configure<MttoView>                 โ
โ   ("Mantenimiento")                   โ
โ - Configure<ClientesView>             โ
โ   ("Clientes")                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Suscribirse a eventos:     โ
โ contentFrame.Navigated     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Navegar a pรกgina inicial:  โ
โ Navigate("Operaciones")    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ


โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    FLUJO DE NAVEGACIรN POR USUARIO                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Usuario hace clic en       โ
โ NavigationViewItem         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ NavigationView.            โ
โ ItemInvoked event          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ MainViewModel.             โ
โ OnNavigationItemInvoked()  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Obtener Tag del item       โ
โ (ej: "Clientes")           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ NavigationService.         โ
โ Navigate(tag)              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Buscar ruta en diccionario โ
โ _routes[tag]               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Frame.Navigate(PageType)   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ WinUI crea instancia       โ
โ de la pรกgina               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Frame.Navigated event      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Actualizar estado:         โ
โ - _currentTag              โ
โ - IsBackEnabled            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ


โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    FLUJO DE NAVEGACIรN HACIA ATRรS                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Usuario hace clic en       โ
โ botรณn "Atrรกs"              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ NavigationView.            โ
โ BackRequested event        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ MainViewModel.             โ
โ OnBackRequested()          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ยฟNavigationService.        โ
โ  CanGoBack?                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โโโโโโโโโโโโฌโโโโโโโโโโโ
              โ Sร       โ NO       โ
              โผ          โผ          โ
     โโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโ
     โ GoBack()    โ โ Ignorar    โโ
     โ             โ โ            โโ
     โโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโ
              โ                     โ
              โผ                     โ
     โโโโโโโโโโโโโโโ                โ
     โ Frame.      โ                โ
     โ GoBack()    โ                โ
     โโโโโโโโโโโโโโโ                โ
              โ                     โ
              โผ                     โ
     โโโโโโโโโโโโโโโ                โ
     โ Restaurar   โ                โ
     โ pรกgina      โ                โ
     โ anterior    โ                โ
     โโโโโโโโโโโโโโโ                โ
```

---

## 4. FLUJO DE LOGGING {#flujo-logging}

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        SISTEMA DE LOGGING                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Cualquier parte del cรณdigo โ
โ necesita registrar un log  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ILoggingService.LogXxxAsync()      โ
โ - LogTraceAsync()                  โ
โ - LogDebugAsync()                  โ
โ - LogInformationAsync()            โ
โ - LogWarningAsync()                โ
โ - LogErrorAsync(msg, exception)    โ
โ - LogCriticalAsync(msg, exception) โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ CreateLogEntry()           โ
โ - Nivel de severidad       โ
โ - Mensaje                  โ
โ - Exception (si existe)    โ
โ - StackTrace               โ
โ - Source (clase)           โ
โ - Method (mรฉtodo)          โ
โ - MachineName              โ
โ - AppVersion               โ
โ - Timestamp (UTC)          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ LoggingService.LogAsync()  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ POST /api/Logging/log      โ
โ (fire-and-forget)          โ
โ Timeout: 5 segundos        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โโโโโโโโโโโโฌโโโโโโโโโโโ
              โ รxito    โ Error    โ
              โผ          โผ          โ
     โโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโ
     โ Log enviado โ โ Silenciar  โโ
     โ al servidor โ โ error      โโ
     โ             โ โ (no afectarโโ
     โ             โ โ  la app)   โโ
     โโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโ
                                    โ
                                    โผ
                      โโโโโโโโโโโโโโโโโโโโโโโโ
                      โ Nota: Los errores de โ
                      โ logging NO deben     โ
                      โ interrumpir el flujo โ
                      โ principal de la app  โ
                      โโโโโโโโโโโโโโโโโโโโโโโโ


โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    EJEMPLO DE USO EN CรDIGO                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

await _logger.LogInformationAsync(
    "Usuario autenticado exitosamente: john.doe", 
    "AuthService", 
    "AuthenticateAsync"
);

await _logger.LogErrorAsync(
    "Error al conectar con la API", 
    exception,
    "OnlineCheck", 
    "CheckAsync"
);
```

---

## 5. FLUJO DE VERIFICACIรN DE CONECTIVIDAD {#flujo-conectividad}

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  VERIFICACIรN DE CONECTIVIDAD API                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ MainViewModel.             โ
โ CheckOnlineStatusAsync()   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ OnlineCheck.CheckAsync()   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ApiEndpointProvider.       โ
โ GetEndpoint("Online")      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Construir URL:                         โ
โ BaseUrl + "Online"                     โ
โ ej: https://localhost:7055/api/Online  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Intentar HEAD request      โ
โ (mรกs ligero que GET)       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ยฟStatus Code?              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โโโโโโโโโโโโโโฌโโโโโโโโโโโโโฌโโโโโโโโโโโโโ
              โ 2xx        โ 405        โ Error      โ
              โผ            โผ            โผ            โ
     โโโโโโโโโโโโโโโ โโโโโโโโโโโโ โโโโโโโโโโโโ     โ
     โ OnlineCheck โ โ Reintentarโ โ Capturar โ     โ
     โ Result.     โ โ con GET   โ โ exceptionโ     โ
     โ Success()   โ โ          โ โ          โ     โ
     โโโโโโโโโโโโโโโ โโโโโโโโโโโโ โโโโโโโโโโโโ     โ
                          โ            โ            โ
                          โผ            โผ            โ
                    โโโโโโโโโโโโ โโโโโโโโโโโโ      โ
                    โ ยฟStatus? โ โ From     โ      โ
                    โ          โ โ Exceptionโ      โ
                    โโโโโโโโโโโโ โโโโโโโโโโโโ      โ
                          โ            โ            โ
                          โโโโโโโฌโโโโโโโ            โ
                          โ 2xx โ Error             โ
                          โผ     โผ                   โ
                    โโโโโโโโโโโโโโโโโโโโ            โ
                    โ Result con       โ            โ
                    โ IsOnline y       โ            โ
                    โ ErrorMessage     โ            โ
                    โโโโโโโโโโโโโโโโโโโโ            โ
                                                    โ
                    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ
                    โผ
     โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
     โ Loggear error si _logger existe  โ
     โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## 6. DIAGRAMA DE DEPENDENCIAS {#diagrama-dependencias}

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    ARQUITECTURA DE DEPENDENCIAS                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

                        โโโโโโโโโโโโโโโ
                        โ   App.xaml  โ
                        โ   (Entry)   โ
                        โโโโโโโโฌโโโโโโโ
                               โ
                               โผ
                    โโโโโโโโโโโโโโโโโโโโ
                    โ  IHost (DI)      โ
                    โ  - Services      โ
                    โ  - Configuration โ
                    โโโโโโโโโโโโโโโโโโโโ
                               โ
        โโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโ
        โ                      โ                      โ
        โผ                      โผ                      โผ
โโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ
โ MainWindow   โ    โ  Services        โ    โ ViewModels  โ
โโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ
        โ                      โ                      โ
        โผ                      โ                      โ
โโโโโโโโโโโโโโโโ              โ                      โ
โ MainViewModelโโโโโโโโโโโโโโโโ                      โ
โโโโโโโโโโโโโโโโ                                     โ
        โ                                             โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
        โ                                             โ
        โผ                                             โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        SERVICIOS                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                             โ
โ  โโโโโโโโโโโโโโโโโโโ      โโโโโโโโโโโโโโโโโโโโ            โ
โ  โ IAuthService    โ      โ INavigationSvc   โ            โ
โ  โ โ               โ      โ โ                โ            โ
โ  โ AuthService     โ      โ NavigationSvc    โ            โ
โ  โโโโโโโโโโฌโโโโโโโโโ      โโโโโโโโโโโโโโโโโโโโ            โ
โ           โ                                                โ
โ           โโโโโโโโโโโโโโโ                                  โ
โ           โผ             โผ                                  โ
โ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ                     โ
โ  โISecureStorageโ  โ IApiEndpoint    โ                     โ
โ  โ โ           โ  โ Provider        โ                     โ
โ  โSecretStorageโ  โ โ               โ                     โ
โ  โWindows      โ  โApiEndpoint      โ                     โ
โ  โโโโโโโโโโโโโโโ  โProvider         โ                     โ
โ                   โโโโโโโโโโโโโโโโโโโ                     โ
โ                                                             โ
โ  โโโโโโโโโโโโโโโโโโโ      โโโโโโโโโโโโโโโโโโโโ            โ
โ  โ ILoggingService โ      โ IOnlineCheck     โ            โ
โ  โ โ               โ      โ โ                โ            โ
โ  โ LoggingService  โ      โ OnlineCheck      โ            โ
โ  โโโโโโโโโโโโโโโโโโโ      โโโโโโโโโโโโโโโโโโโโ            โ
โ                                                             โ
โ  โโโโโโโโโโโโโโโโโโโ      โโโโโโโโโโโโโโโโโโโโ            โ
โ  โ IDialogService  โ      โ Authenticated    โ            โ
โ  โ โ               โ      โ HttpHandler      โ            โ
โ  โ DialogService   โ      โ (DelegatingHndlr)โ            โ
โ  โโโโโโโโโโโโโโโโโโโ      โโโโโโโโโโโโโโโโโโโโ            โ
โ                                  โ                          โ
โ                                  โผ                          โ
โ                         โโโโโโโโโโโโโโโโโโโ                โ
โ                         โ Lazy<IAuthSvc>  โ                โ
โ                         โ (rompe ciclo)   โ                โ
โ                         โโโโโโโโโโโโโโโโโโโ                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ


โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    FLUJO DE HTTPCLIENTS                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  HttpClient (OnlineCheck)                            โ
โ  - Timeout: 5 segundos                               โ
โ  - No usa AuthenticatedHttpHandler                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  HttpClient (LoggingService)                         โ
โ  - BaseAddress: API BaseUrl                          โ
โ  - Timeout: 5 segundos                               โ
โ  - No usa AuthenticatedHttpHandler                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  HttpClient (AuthService)                            โ
โ  - BaseAddress: API BaseUrl                          โ
โ  - Timeout: 30 segundos                              โ
โ  - USA AuthenticatedHttpHandler โ Pipeline           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
      โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
      โ  AuthenticatedHttpHandler         โ
      โ  - Adjunta Bearer token           โ
      โ  - Maneja 401 (refresh + retry)   โ
      โ  - Solo para requests a API host  โ
      โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
      โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
      โ  Lazy<IAuthService>               โ
      โ  - Resuelve IAuthService cuando   โ
      โ    se necesita (evita ciclo)      โ
      โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ


โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      VISTAS Y PรGINAS                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโ
โ MainWindow   โ
โโโโโโโโฌโโโโโโโโ
       โ
       โโโโโโโโโโโโโโโโ
       โ              โ
       โผ              โผ
โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโ
โ Navigation  โ  โ Content Frame    โ
โ View        โ  โ (muestra pรกginas)โ
โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโ
                         โ
        โโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโ
        โ                โ                โ
        โผ                โผ                โผ
โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ
โOperaciones   โ  โ Asesoria     โ  โ Mantenimientoโ
โView          โ  โ View         โ  โ View (Mtto)  โ
โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ
        โ
        โผ
โโโโโโโโโโโโโโโโ
โ Clientes     โ
โ View         โ
โโโโโโโโโโโโโโโโ
        โ
        โผ
โโโโโโโโโโโโโโโโ
โ Customers    โ
โ ViewModel    โ
โโโโโโโโโโโโโโโโ
```

---

## RESUMEN DE FLUJOS CLAVE

### 1. **Inicio de Aplicaciรณn**
   - App.xaml.cs configura DI โ OnLaunched โ MainWindow โ MainViewModel

### 2. **Autenticaciรณn**
   - LoadFromStorageAsync (background) โ AuthenticateAsync โ PersistTokensAsync
   - GetAccessTokenAsync con auto-refresh
   - AuthenticatedHttpHandler intercepta y aรฑade tokens

### 3. **Navegaciรณn**
   - Configure rutas โ NavigationView events โ Navigate(tag) โ Frame.Navigate(Type)

### 4. **Logging**
   - LogXxxAsync โ CreateLogEntry โ POST a servidor (fire-and-forget)

### 5. **Conectividad**
   - CheckAsync โ HEAD/GET a endpoint โ OnlineCheckResult

---

**Nota:** Este diagrama representa el estado actual del cรณdigo. LoginView no estรก implementado funcionalmente segรบn las especificaciones del proyecto.
